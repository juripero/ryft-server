# Demo April 28, 2015

Search Mode, new `ryftrest` tool and query decomposition.

RyftOne-0004 is used for demo.

`ryftrest` is simple bash script located at ryftuser's home.
Syntax is very similar to `ryftprim` tool.
Try `~/ryftrest --help` for details.


## Search Mode

Ryft server now supports a new `mode` parameter which could be one of:

- `es` for exact search
- `fhs` for fuzzy hamming search
- `feds` for fuzzy edit distance search
- `ds` for date search
- `ts` for time search
- `ns` for numeric search (hardware doesn't support yet)

empty or missing `mode` means `fhs` for common cases. But if query
contains *DATE* or *TIME* keywords `ds` or `ts` will be used.

### the following command use fuzzy hamming search

`ryftprim -p fhs -q '(RECORD.desc CONTAINS "Jones")' -f mychicagoJones.pcrime -d 1 -v`

`~/ryftrest -p fhs -q '(RECORD.desc CONTAINS "Jones")' -f mychicagoJones.pcrime -d 1 -v --local --format=xml --fields=ID,Description`


### let's change search mode to fuzzy edit distance

`ryftprim -p feds -q '(RECORD.desc CONTAINS "Jones")' -f mychicagoJones.pcrime -d 1 -v`

`~/ryftrest -p feds -q '(RECORD.desc CONTAINS "Jones")' -f mychicagoJones.pcrime -d 1 -v --local --format=xml --fields=ID,Description`

number of matches should be greater.


### let's try date search

`ryftprim -p ds -q '(RECORD.date CONTAINS DATE(MM/DD/YYYY > 04/13/2015))' -f mychicago.pcrime -v`

`~/ryftrest -p ds -q '(RECORD.date CONTAINS DATE(MM/DD/YYYY > 04/13/2015))' -f mychicago.pcrime -v --local --format=xml`


### let's try time search

`ryftprim -p ts -q '(RECORD.date CONTAINS TIME(HH:MM:SS > 10:20:00))' -f mychicago.pcrime -v`

`~/ryftrest -p ts -q '(RECORD.date CONTAINS TIME(HH:MM:SS > 10:20:00))' -f mychicago.pcrime -v --local --format=xml`


## Query decomposition

### now let's try to use complex queries

Note, `ryftprim` doesn't support query decomposition so we will use `ryftrest` instead.

`~/ryftrest -q '(RECORD.id CONTAINS "1003")' -f mychicago.pcrime -v --local --format=xml --fields=ID,Date,Description`  should report 16 matches

`~/ryftrest -q '(RECORD.id CONTAINS "1003") AND (RECORD.date CONTAINS DATE(MM/DD/YYYY > 04/14/2015))' -f mychicago.pcrime -v --local --format=xml --fields=ID,Date,Description`  should report 4 matches

`~/ryftrest -q '(RECORD.id CONTAINS "1003") AND (RECORD.date CONTAINS DATE(MM/DD/YYYY > 04/14/2015)) AND (RECORD.date CONTAINS TIME(HH:MM:SS > 08:30:00))' -f mychicago.pcrime -v --local --format=xml --fields=ID,Date,Description`  should report 2 matches

we also support `OR` operator but it is not recommended to use it:

- duplicate records are possible
- big data files might be copied (we have to copy two intermediate result files into one)

second issue details: having "A OR B" query we have to call search two times: for "A" and "B" expressions with the same input data.
Once search is done we have two result files: `A-result.dat` and `B-result.dat` which should be combined into one.
So we have to create `result.dat` and copy content of `A-result.dat` and `B-result.dat`.
That operation could impact overall system performance. Specially for complex queries containing multiple `OR` operators.
