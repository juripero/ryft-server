# Demo May 12, 2015

Support for JSON format, updated ryftrest tool and query decomposition.

## Updated ryftrest tool

To minimize tool output new `--count` option is now supported.
Passing this flag makes the tool use `/count` endpoint instead of `/search`.
Only the search statistics will be printed, no any records.

`ryftrest -q '(RECORD.id CONTAINS "100310")' -f '*.pcrime' --local --format=xml --fields=ID,Date --count`

Debian package places the ryftrest tool at `/usr/bin/` directory.

### Advanced processing

Alternative option to minimize ryftrest tool output
is to use `jq` command line JSON processor:

`ryftrest -q '(RECORD.id CONTAINS "100310")' -f '*.pcrime' --local --format=xml --fields=ID,Date | jq ".stats"`

This command is almost equal to the previous one.

Note, without `--count` option all data is still transferred.
All processing is done on the client side.

Using `jq` it's possible to do advanced data processing:

`ryftrest -q '(RECORD.id CONTAINS "100310")' -f '*.pcrime' --local --format=xml --fields=ID,Date | jq ".results[].Date"`

This command will print list of date strings.


## Preserve search results

By default all search results are deleted from the Ryft server once they are delivered to user.
But to have "search in the previous results" feature there are two query parameters: `data=` and `index=`.

First `data=output.dat` parameter keeps the search results on the Ryft server under `/ryftone/output.dat`.
It is possible to use that file as an input for the subsequent search call `files=output.dat`.

Note, it is important to use consistent file extension for the structured search
in order to let Ryft use appropriate RDF scheme!

Second `index=index.txt` parameter keeps the search index under `/ryftone/index.txt`.

These `data=` and `index=` query parameters are supported by the `/search` and `/count` endpoints.

In case of complex search expression query decomposition saves data and index of the top subquery.

For now there is no way to delete such intermediate result file.
At least until `DELETE /files` API endpoint will be implemented.

TODO: examples!!!


## JSON format support

If input file set contains JSON data, the found records could be decoded. Just pass `format=json` query parameter.

Moreover, to minimize output or to get just subset of fields the `fields=` query parameter could be used.
For example to get `AlterEgo` field from a `Citizens.json` file pass `format=json&fields=Name`.

Note, JSON format (just like XML) could be used with structured search only!

  
## Points to discuss

### Numeric search

We've implemented numeric search in the same way date and time search was implemented.
But since no hardware or virtual machine supports numeric search there is no way to test this feature.

### libryftone thread safety

Since libryftone is not thread-safe there is no point to use it in multi-threaded ryft-server code.
libryftone requires one call per process just like ryftprim does.

Anyway libryftone search engine is almost completed. Once libryftone will be thread-safe we can easy switch to new search engine.

I'm going to prepare some slides about search engine abstractions and internal ryft-server architecture if it's interesting.
