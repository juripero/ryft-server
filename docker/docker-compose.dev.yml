version: '3.1'
services:
  dev:
    image: ${REGISTRY}/ryft/builder:${BUILDER_VERSION}
    volumes:
      - ../:/usr/src/github.com/getryft/ryft-server
      - ~/.ssh:/root/.ssh
      - ./ryftone:/ryftone
      - ./app/etc/ryft-server.conf:/etc/ryft-server.conf
      - ./app/etc/ryft-user.yaml:/etc/ryft-user.yaml
      - ./app/ryftx:/usr/bin/ryftx
      - ./app/ryftprim:/usr/bin/ryftprim
    ports:
      - 8765:8765
    environment:
      - GOPATH=/usr
      - GOROOT=/usr/local/go
    working_dir: /usr/src/github.com/getryft/ryft-server
    command: make build && ./ryft-server --config=/etc/ryft-server.conf --address :8765 --debug

 consul:
    image: consul:0.8.0
    container_name: "consul"
    hostname: "consul"
    ports:
      - 8400
      - 8500
      - 8600
