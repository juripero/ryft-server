#!/bin/bash

VERSION=$1

if [ -z "$VERSION" ]; then
	VERSION=0.1
fi

DEBNAME="ryft-server-${VERSION}_amd64.deb"
CONTROLFILE="ryft-server/DEBIAN/control"


echo Package: ryft-server > $CONTROLFILE
echo Version: $VERSION >> $CONTROLFILE
echo Section: custom >> $CONTROLFILE
echo Priority: optional >> $CONTROLFILE
echo Architecture: amd64 >> $CONTROLFILE
echo Essential: no >> $CONTROLFILE
echo Installed-Size: 1024 >> $CONTROLFILE
echo Maintainer: www.ryft.com >> $CONTROLFILE
echo Description: ryft-server >> $CONTROLFILE


if [ ! -d "ryft-server/usr/bin" ]; then
  mkdir -pv ryft-server/usr/bin
fi

FILE_RYFT_SERVER="$GOPATH/bin/ryft-server"

if [ -f $FILE_RYFT_SERVER ]; then
	cp $FILE_RYFT_SERVER ryft-server/usr/bin/
	dpkg --build ryft-server

	if [ -f "$DEBNAME" ]; then
	  rm ${DEBNAME}
	fi

	mv ryft-server.deb ${DEBNAME}

else
	echo "No file = $FILE_RYFT_SERVER was founded"
	echo "Please go to ~/src/ryft-server/ and make 'go build' command"
fi
